#include <iostream>
#include <vector>
#include<string.h>
#include<iterator>
#include<cmath>

using namespace std;

//defining struct student to contain four variables
struct Student {

  char firstName[20];
  char lastName[20];
  int studentId;
  float GPA;

};
struct Node {

  Node* next = NULL;
  Student* s = NULL;
  
};

bool addStudent(Node** &hashtable, int size, vector<int> &keys);
void printStudent(Node** &hashtable, int size);
void deleteStudent(Node** &hashtable, int size);
int hashIt(int key, int size);
void rehash(Node** &hashtable, int size, vector<int> keys);
void errorMessage();

int main() {
  //vector<Student> studentList(20);
  int size = 101;
  Node** ht = new Node*[size];
  vector<int> keys;
  for(int a = 0; a < 101; a++){
    ht[a]=nullptr;
  }
  while(true){
    cout << "Type add,print,delete, or quit" <<  endl;
    char input[20];
    cin >> input;
    cin.get();
    if(input[0]=='a' || input[0]=='A'){
      bool full = addStudent(ht, size, keys);
      if(full){
	cout << "more than 3 entris" << endl;
	size = size*2;
	rehash(ht,size,keys);
      }
      full = false;
    }
    else if(input[0]=='p' || input[0]=='P'){
      printStudent(ht, size);
    }
    else if(input[0]=='d' || input[0]=='D'){
      deleteStudent(ht, size);
    }
    else if(input[0]=='q' || input[0]=='Q'){
      break;
    }
  }
  
  return 0;
  
}

void rehash(Node** &hashtable, int size, vector<int> keys){
  Node** temp = new Node*[size];
  for(vector<int>::iterator it = keys.begin(); it!=keys.end(); it++){
    temp[hashIt(*it,size)] = hashtable[hashIt(*it,size/2)]; 
  }
  delete[] hashtable;
  return temp;
}

int hashIt(int key, int size){
  //123456
  int hundredthousands = (key/100000);
  cout << hundredthousands;
  int tenthousands = (key%100000-key%10000)/10000;
  cout << tenthousands;
  int thousands = (key%10000-key%1000)/1000;
  cout << thousands;
  int hundreds = (key%1000-key%100)/100;
  cout << hundreds;
  int tens = (key%100-key%10)/10;
  cout << tens;
  int ones = key %10;
  cout << ones;
  int index = ((tens*10)+ones);
  index = index*(thousands+1);
  index += hundreds;
  index += tenthousands;
  index += hundredthousands;
  index = index%size;
  cout << index <<  endl;
  /*
  int shortened = key%100000;
  shortened = (shortened-key%10)/10;
  int index = ((shortened%1000)/10)+(shortened%10)+(shortened/1000);
  index = index % 101;
  return index;*/
  return index;
}

bool addStudent(Node** &hashtable, int size, vector<int> &keys){
  	cout << "Please enter the student's first name" << endl;
	char firstNamee[20];
	cin >> firstNamee;
	cin.get();
	cout << "Please enter the student's last name" << endl;
	char lastNamee[20];
	cin >> lastNamee;
	cin.get();
	cout << "Please enter the 6 digit studen't id number" << endl;
	int studentIdd;
	cin >> studentIdd;
	cin.get();
	cout << "Please enter the student's GPA" << endl;
	float GPAA;
	cin >>  GPAA;
	cin.get();
        Student* addS = new Student;
	strcpy(addS->firstName,firstNamee);
	strcpy(addS->lastName,lastNamee);
	addS->studentId = studentIdd;
	addS->GPA = GPAA;
	int index = hashIt(addS->studentId, size);
	Node* addN = new Node;
	(addN->s) = addS;
	keys.push_back(studentIdd);
	if(hashtable[index]==nullptr){
	  hashtable[index] = addN;
	  return false;
	}
	else{
	  Node* temp = hashtable[index];
	  hashtable[index] = addN;
	  addN->next = temp;
	  Node* current = hashtable[index];
	  int count = 1;
	  while(current->next!=NULL){
	    current = current->next;
	    count++;
	    cout << current << " nodes" << endl;
	  }
	  if(count>3){
	    return true;
	  }
	  return false;
	}
}

void printStudent(Node** &hashtable, int size){
  cout << "Please print out the student id of the student you wish to print" <<  endl;
  int id;
  cin >> id;
  cin.get();
  int index = hashIt(id, size);
  if(hashtable[index]==nullptr){
    errorMessage();
    return;
  }
  else if(hashtable[index]->next==NULL){
    if(hashtable[index]->s->studentId!=id){
      errorMessage();
      return;
    }
    char firstName[20];
    strcpy(firstName,hashtable[index]->s->firstName);
    cout << firstName;
    char lastName[20];
    strcpy(lastName,hashtable[index]->s->lastName);
    cout <<" " << lastName << ", ";
    cout << "student ID: " << id << ", ";
    float gpa1 = floor(hashtable[index]->s->GPA*100+0.5)/100;
    cout << "and GPA of " << gpa1 << endl;
  }
  else{
    Node* current;
    current = hashtable[index];
    while(current->s->studentId!=id){
      if(current->next==NULL){
	errorMessage();
	return;
      }
      current = current->next;
    }
    char firstName[20];
    strcpy(firstName,current->s->firstName);
    cout << firstName;
    char lastName[20];
    strcpy(lastName,current->s->lastName);
    cout <<" " << lastName << ", ";
    cout << "student ID: " << id << ", ";
    float gpa1 = floor(current->s->GPA*100+0.5)/100;
    cout << "and GPA of " << gpa1 << endl;
  }
}

void deleteStudent(Node** &hashtable, int size){
  cout << "enter the ID number of the student you would like to delete" << endl;
  int id;
  cin >> id;
  cin.get();
  int index = hashIt(id, size);
  if(hashtable[index]==nullptr){
    errorMessage();
    return;
  }
  else if(hashtable[index]->next==NULL){
    if(hashtable[index]->s->studentId!=id){
      errorMessage();
      return;
    }
    Node* temp = hashtable[index];
    hashtable[index] = nullptr;
    delete (temp->s);
    delete temp;
  }
  else{
    Node* current;
    Node* previous;
    previous=NULL;
    current = hashtable[index];
    while(current->s->studentId!=id){
      if(current->next==NULL){
	errorMessage();
        return;
      }
      previous = current;
      current = current->next;
    }
    if(current->next==NULL){
      previous->next = NULL;
      delete (current->s);
      delete current;
    }
    else if(previous==NULL){
      hashtable[index] = current->next;
      delete (current->s);
      delete current;
    }
    else{
      previous->next = current->next;
      delete (current->s);
      delete current;
    }
  }
}

void errorMessage(){
  cout << "this entry does not exist" << endl;
}
